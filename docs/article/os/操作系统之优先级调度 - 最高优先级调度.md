# 操作系统之优先级调度 - 最高优先级调度

## 一、简述

> 优先级调度的含义：

（1）当该算法用于作业调度时，系统从后备作业队列中选择若干个优先级最高的，且系统能满足资源要求的作业装入内存运行。

（2）当该算法用于进程调度时，将把处理机分配给就绪进程队列中优先级最高的进程。



> 调度算法的两种方式：

1. `非抢占式优先级算法`：在这种调度方式下，系统一旦把处理机分配给就绪队列中优先级最高的进程后，该进程就能一直执行下去，直至完成；或因等待某事件的发生使该进程不得不放弃处理机时，系统才能将处理机分配给另一个优先级高的就绪进程。
2. `抢占式优先级调度算法`：在这种调度方式下，进程调度程序把处理机分配给当时优先级最高的就绪进程，使之执行。一旦出现了另一个优先级更高的就绪进程时，进程调度程序就停止正在执行的进程，将处理机分配给新出现的优先级最高的就绪进程。



## 二、例题

​	在道数不受限制的多道程序系统中，作业进入系统的后备队列时立即进行作业调度。现有4个作业进入系统，有关信息为：

| 作业名 | 提交时刻（进入后备队列时刻） | 运行时间（执行时间/min） | 优先数（数值越大，优先级越高） |
| :----: | :--------------------------: | :----------------------: | ------------------------------ |
|   p1   |             8:00             |            60            | 1                              |
|   p2   |             8:30             |            50            | 2                              |
|   p3   |             8:40             |            30            | 4                              |
|   p4   |             8:50             |            10            | 3                              |



>  答：

| 作业名 | 提交时刻 | 运行时间 | 开始时刻 | 完成时刻 | 周转时间 | 带权周转时间 |
| ------ | -------- | -------- | -------- | -------- | -------- | ------------ |
| p1     | 8:00     | 60       | (1)      | (2)      | (9)      | (13)         |
| p2     | 8:30     | 50       | (3)      | (4)      | (10)     | (14)         |
| p3     | 8:40     | 30       | (5)      | (6)      | (11)     | (15)         |
| p4     | 8:50     | 10       | (7)      | (8)      | (12)     | (16)         |

平均周转时间T = ？

平均带权周转时间T = ？

---

### 1、非抢占式

原则：系统一旦把处理机分配给就绪队列中优先级最高的进程后，该进程就能一直执行下去，直至完成。

- 四个作业内，优先级依次从大到小依次为：p3 > p4 > p2 > p1

- 解题：

  1. 8：00时刻只有p1进入了，所以先执行p1，从8：00开始执行，执行60，到9：00时刻，p1执行完成；
     - 所以`（1）填下8：00`，`（3）填下8：30`
  2. 9：00时刻p2、p3、p4都进入了系统，但是优先级p3 > p4 > p2，所有p3先执行，从9：00开始执行，执行30，到9：30时刻，p3执行完成；
     - 所以`（3）填写9：00`，`（4）填写9：30`
  3. 9：30时刻，此时系统中存在作业为p2、p4，但是优先级p4 > p2；所以p4先执行，从9：30开始执行，执行10，到9：40时刻，p4执行完成；
     - 所以`（5）填写9：30`，`（6）填写9：40`
  4. 9：40时刻，此时系统内只存在作业p2，所以执行p2，从9：40开始执行，执行50，到10：30时刻，p2执行完成；
     - 所以`（7）填写9：40`，`（8）填写10：30`

- **依据下列公式计算-对应表格为**：

  | 作业名 | 提交时刻 | 运行时间 | 开始时刻 | 完成时刻 | 周转时间 | 带权周转时间    |
  | ------ | -------- | -------- | -------- | -------- | -------- | --------------- |
  | p1     | 8：00    | 60       | 8：00    | 9：00    | 60       | 1               |
  | p2     | 8：30    | 50       | 9：40    | 10：30   | 120      | 120  / 50 = 2.4 |
  | p3     | 8：40    | 30       | 9：00    | 9：30    | 50       | 50 / 30 = 1.7   |
  | p4     | 8：50    | 10       | 9：30    | 9：40    | 50       | 5               |

  平均周转时间T = （60+120+50+50）div 4 = 70

  平均带权周转时间T = （1+2.4+1.7+5）div 4 = 2.525 = 2.6

  

### 2、抢占式

原则：这种调度方式下，进程调度程序把处理机分配给当时优先级最高的就绪进程，使之执行。一旦出现了另一个优先级更高的就绪进程时，进程调度程序就停止正在执行的进程，将处理机分配给新出现的优先级最高的就绪进程

- 四个作业内，优先级依次从大到小依次为：p3 > p4 > p2 > p1

- 解题：

  1. 8：00时刻只有p1进入了，所以先执行p1，从8：00开始执行，执行到8：30时刻，p2进入了，所以被p2抢占了，8：30开始p2开始执行，执行到8：40时刻，p3进入了，所以又被p3抢占了，由于p3的优先级最高，它不会被抢占，会一直执行下去，直达执行完成，所以8：50开始，p3开始执行，执行30，到10：20时刻执行完成，此时p3执行完成；
     - 所以`（1）填下8：00`，`（3）填下8：30`，`（5）填下8：40`，`（6）空填下10：20`
     - 在10：20时刻：`p1剩余30`，`p2剩余40`，`p4也进入了剩余10`
  2.  10：20时刻p1、p2、p3、p4都进入了系统，但是p3执行完成了，此时剩余作业的优先级p4 > p2 > p1且没有剩余未进入的作业，则接下来按优先级顺序执行，且不会被抢占，因为依次执行的顺序是从优先级高的到优先级低的，所有p4先执行，从10：20开始执行，执行10，到10：30时刻，p4执行完成；
     - 所以`（7）填写10：20`，`（8）填写10：30`
  3. 10：30时刻，此时系统中存在作业为p1、p2，但是优先级p2 > p1；所以p2先执行，从10：30开始执行，执行40，到10：40时刻，p2执行完成；
     - 所以`（4）填写11：10`
  4. 11：10时刻，此时系统内只存在作业p1，所以执行p1，从11：10开始执行，执行30，到11：40时刻，p1执行完成；
     - 所以`（2）填写9：40`

- **依据下列公式计算-对应表格为**：

  | 作业名 | 提交时刻 | 运行时间 | 开始时刻 | 完成时刻 | 周转时间 | 带权周转时间 |
  | ------ | -------- | -------- | -------- | -------- | -------- | ------------ |
  | p1     | 8：00    | 60       | 8：00    | 11：40   | 220      | 220/60       |
  | p2     | 8：30    | 50       | 8：40    | 11：10   | 160      | 160/50       |
  | p3     | 8：40    | 30       | 8：40    | 10：20   | 100      | 100/30       |
  | p4     | 8：50    | 10       | 10：20   | 10：30   | 100      | 10           |

  平均周转时间T = （220+160+100+100）div 4 = 

  平均带权周转时间T = （220/60+160/50+100/30+10）div 4 = 

## 三、公式

1. 完成时刻 = 开始时刻 + 运行时间
2. 周转时间 = 完成时间 - 到达时间（进入时间 / 提交时刻）
3. 带权周转时间 = 周转时间 / 运行时间